define("pages/myaccount",["modules/backbone-mozu","hyprlive","hyprlivecontext","modules/jquery-mozu","underscore","modules/models-customer","modules/views-paging","modules/api"],function(t,e,n,i,a,d,r,o){var s=t.MozuView.extend({constructor:function(){t.MozuView.apply(this,arguments),this.editing={}},getRenderContext:function(){var e=t.MozuView.prototype.getRenderContext.apply(this,arguments);return e.editing=this.editing,e},doModelAction:function(t,e){var n=this,i=function(){n.render()},a=this.model[t](e);return a&&a.then?(a.then(i,i),a):void 0}}),c=s.extend({templateName:"modules/my-account/my-account-settings",autoUpdate:["firstName","lastName","oldPassword","password","confirmPassword","acceptsMarketing"],updateAcceptsMarketing:function(t){var e=i(t.currentTarget).prop("checked");this.model.set("acceptsMarketing",e),this.model.updateAcceptsMarketing(e)},startEditName:function(){this.editing.name=!0,this.render()},cancelEditName:function(){this.editing.name=!1,this.render()},finishEditName:function(){var t=this;this.doModelAction("updateName").otherwise(function(){t.editing.name=!0}),this.editing.name=!1},startEditPassword:function(){this.editing.password=!0,this.render()},finishEditPassword:function(){var t=this;this.doModelAction("changePassword").then(function(){a.delay(function(){t.$('[data-mz-validationmessage-for="passwordChanged"]').show().text(e.getLabel("passwordChanged")).fadeOut(3e3)},250)},function(){t.editing.password=!0}),this.editing.password=!1},cancelEditPassword:function(){this.editing.password=!1,this.render()}}),g=s.extend({templateName:"modules/my-account/my-account-wishlist",addItemToCart:function(t){var e=i(t.currentTarget),n=e.data("mzItemId");return n?(this.editing.added=n,this.doModelAction("addItemToCart",n)):void 0},doNotRemove:function(){this.editing.added=!1,this.editing.remove=!1,this.render()},beginRemoveItem:function(t){var e=i(t.currentTarget).data("mzItemId");e&&(this.editing.remove=e,this.render())},finishRemoveItem:function(t){var e=this,n=i(t.currentTarget).data("mzItemId");if(n){var a=n;return this.model.apiDeleteItem(n).then(function(){e.editing.remove=!1;var t=e.model.get("items").where({id:a});t&&(e.model.get("items").remove(t),e.render())})}}}),m=t.MozuView.extend({templateName:"modules/my-account/order-history-list",autoUpdate:["rma.returnType","rma.reason","rma.quantity","rma.comments"],initialize:function(){this.listenTo(this.model,"change:pageSize",a.bind(this.model.changePageSize,this.model))},getRenderContext:function(){var e=t.MozuView.prototype.getRenderContext.apply(this,arguments);return e.returning=this.returning,e},startReturnItem:function(t){var e=i(t.currentTarget),n=e.data("mzStartReturn"),a=e.data("mzOrderId");n&&a&&(this.returning=n,this.model.startReturn(a,n)),this.render()},cancelReturnItem:function(){delete this.returning,this.model.clearReturn(),this.render()},finishReturnItem:function(){var t=this,e=this.model.finishReturn();return e?e.then(function(){delete t.returning,t.render()}):void 0}}),u=t.MozuView.extend({templateName:"modules/my-account/return-history-list",initialize:function(){var t=this;this.listenTo(this.model,"change:pageSize",a.bind(this.model.changePageSize,this.model)),this.listenTo(this.model,"returndisplayed",function(e){var n=t.$('[data-mz-id="'+e+'"]');0===n.length&&(n=t.$el),n.ScrollTo({axis:"y"})})}}),l=s.extend({templateName:"modules/my-account/my-account-paymentmethods",autoUpdate:["editingCard.paymentOrCardType","editingCard.nameOnCard","editingCard.cardNumberPartOrMask","editingCard.expireMonth","editingCard.expireYear","editingCard.cvv","editingCard.isCvvOptional","editingCard.contactId","editingContact.firstName","editingContact.lastNameOrSurname","editingContact.address.address1","editingContact.address.address2","editingContact.address.address3","editingContact.address.cityOrTown","editingContact.address.countryCode","editingContact.address.stateOrProvince","editingContact.address.postalOrZipCode","editingContact.address.addressType","editingContact.phoneNumbers.home","editingContact.isBillingContact","editingContact.isPrimaryBillingContact","editingContact.isShippingContact","editingContact.isPrimaryShippingContact"],renderOnChange:["editingCard.contactId","editingContact.address.countryCode"],beginEditCard:function(t){var e=this.editing.card=t.currentTarget.getAttribute("data-mz-card");this.model.beginEditCard(e),this.render()},finishEditCard:function(){var t=this,e=this.doModelAction("saveCard");e&&(e.otherwise(function(){t.editing.card=!0}),this.editing.card=!1)},cancelEditCard:function(){this.editing.card=!1,this.model.endEditCard(),this.render()},beginDeleteCard:function(t){var n=t.currentTarget.getAttribute("data-mz-card"),i=this.model.get("cards").get(n);window.confirm(e.getLabel("confirmDeleteCard",i.get("cardNumberPart")))&&this.doModelAction("deleteCard",n)}}),h=s.extend({templateName:"modules/my-account/my-account-addressbook",autoUpdate:["editingContact.firstName","editingContact.lastNameOrSurname","editingContact.address.address1","editingContact.address.address2","editingContact.address.address3","editingContact.address.cityOrTown","editingContact.address.countryCode","editingContact.address.stateOrProvince","editingContact.address.postalOrZipCode","editingContact.address.addressType","editingContact.phoneNumbers.home","editingContact.isBillingContact","editingContact.isPrimaryBillingContact","editingContact.isShippingContact","editingContact.isPrimaryShippingContact"],renderOnChange:["editingContact.address.countryCode","editingContact.isBillingContact","editingContact.isShippingContact"],beginAddContact:function(){this.editing.contact="new",this.render()},beginEditContact:function(t){var e=this.editing.contact=t.currentTarget.getAttribute("data-mz-contact");this.model.beginEditContact(e),this.render()},finishEditContact:function(){var t=this,e=n.locals.siteContext.generalSettings.isAddressValidationEnabled,i=this.doModelAction("saveContact",{forceIsValid:e});i&&(i.otherwise(function(){t.editing.contact=!0}),this.editing.contact=!1)},cancelEditContact:function(){this.editing.contact=!1,this.model.endEditContact(),this.render()},beginDeleteContact:function(t){var n=t.currentTarget.getAttribute("data-mz-contact"),i=this.model.get("contacts").get(n);window.confirm(e.getLabel("confirmDeleteContact",i.get("address").get("address1")))&&this.doModelAction("deleteContact",n)}}),C=t.MozuView.extend({templateName:"modules/my-account/my-account-storecredit",addStoreCredit:function(){var t=this,e=this.$("[data-mz-entering-credit]").val();return e?this.model.addStoreCredit(e).then(function(){return t.model.getStoreCredits()}):void 0}});i(document).ready(function(){var t,e=window.accountModel=d.EditableCustomer.fromCurrent(),s=i("#account-settings"),p=i("#account-orderhistory"),f=i("#account-returnhistory"),y=i("#account-paymentmethods"),w=i("#account-addressbook"),v=i("#account-wishlist"),b=i("#account-messages"),z=i("#account-storecredit"),N=e.get("orderHistory"),E=e.get("returnHistory"),P=window.accountViews={settings:new c({el:s,model:e,messagesEl:b}),orderHistory:new m({el:p.find("[data-mz-orderlist]"),model:N}),orderHistoryPagingControls:new r.PagingControls({templateName:"modules/my-account/order-history-paging-controls",el:p.find("[data-mz-pagingcontrols]"),model:N}),orderHistoryPageNumbers:new r.PageNumbers({el:p.find("[data-mz-pagenumbers]"),model:N}),returnHistory:new u({el:f.find("[data-mz-orderlist]"),model:E}),returnHistoryPagingControls:new r.PagingControls({templateName:"modules/my-account/order-history-paging-controls",el:f.find("[data-mz-pagingcontrols]"),model:E}),returnHistoryPageNumbers:new r.PageNumbers({el:f.find("[data-mz-pagenumbers]"),model:E}),paymentMethods:new l({el:y,model:e,messagesEl:b}),addressBook:new h({el:w,model:e,messagesEl:b}),storeCredit:new C({el:z,model:e,messagesEl:b})};n.locals.siteContext.generalSettings.isWishlistCreationEnabled&&(t=e.get("wishlist"),P.wishList=new g({el:v,model:t,messagesEl:b})),a.invoke(window.accountViews,"render"),t&&o.all.apply(o,t.get("items").map(function(t){var e=t.get("product"),n=e.get("options").map(function(t){return{attributeFQN:t.get("attributeFQN"),value:t.get("value")}});return 0===n.length?e:e.apiConfigure({options:n},{useExistingInstances:!0}).then(function(e){t.set("product",e.data)})})).then(function(){P.wishList.render()})})});